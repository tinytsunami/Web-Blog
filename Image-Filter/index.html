<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="hsl(210deg 20% 25%)">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/icon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/icon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="hsl(210deg 20% 25%)">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.tinytsunami.info","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="這次的主題是影像濾波（image filter）。 這也是大學影像處理課的內容，基本的東西已經寫過了，原先考慮到加入一些其他新東西，可是後來想說不要把文章複雜化，所以新東西可能之後才會發。">
<meta property="og:type" content="article">
<meta property="og:title" content="影像濾波 Image Filter">
<meta property="og:url" content="https://www.tinytsunami.info/Image-Filter/index.html">
<meta property="og:site_name" content="羊羽手札">
<meta property="og:description" content="這次的主題是影像濾波（image filter）。 這也是大學影像處理課的內容，基本的東西已經寫過了，原先考慮到加入一些其他新東西，可是後來想說不要把文章複雜化，所以新東西可能之後才會發。">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://i.imgur.com/naVLmQK.png">
<meta property="og:image" content="https://i.imgur.com/kQbriZT.png">
<meta property="og:image" content="https://i.imgur.com/mGqhnpg.png">
<meta property="og:image" content="https://i.imgur.com/yu7R0R9.png">
<meta property="og:image" content="https://i.imgur.com/Gpzy1P3.png">
<meta property="og:image" content="https://i.imgur.com/yAxd9OO.png">
<meta property="og:image" content="https://i.imgur.com/mIttFB5.png">
<meta property="og:image" content="https://i.imgur.com/3CBMICm.png">
<meta property="og:image" content="https://i.imgur.com/DgqiZSQ.png">
<meta property="article:published_time" content="2020-08-02T00:00:00.000Z">
<meta property="article:modified_time" content="2022-02-19T18:21:02.144Z">
<meta property="article:author" content="Tinytusnami">
<meta property="article:tag" content="技術, 獨立遊戲">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/naVLmQK.png">

<link rel="canonical" href="https://www.tinytsunami.info/Image-Filter/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>

  <title>影像濾波 Image Filter | 羊羽手札</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">羊羽手札</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Tinytsunami's Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>關於</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分類</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歷程表</a>

  </li>
        <li class="menu-item menu-item-game">

    <a href="https://tinytsunami.itch.io/" rel="noopener" target="_blank"><i class="fas fa-gamepad fa-fw"></i>遊戲</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜尋..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://www.tinytsunami.info/Image-Filter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpg">
      <meta itemprop="name" content="Tinytusnami">
      <meta itemprop="description" content="羊羽的個人部落格">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="羊羽手札">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          影像濾波 Image Filter
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2020-08-02 00:00:00" itemprop="dateCreated datePublished" datetime="2020-08-02T00:00:00Z">2020-08-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2022-02-19 18:21:02" itemprop="dateModified" datetime="2022-02-19T18:21:02Z">2022-02-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B%E8%88%87%E6%BC%94%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">資料結構與演算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>這次的主題是影像濾波（image filter）。</p>
<p>這也是大學影像處理課的內容，基本的東西已經寫過了，<br>原先考慮到加入一些其他新東西，可是後來想說不要把文章複雜化，<br>所以新東西可能之後才會發。</p>
<span id="more"></span>

<div class="note success">
            <p>請參閱 <a href="/ming-chuan-university-homework/" title="我的大學作業整理">我的大學作業整理</a> 的「影像處理課程」部分。</p>
          </div>

<h1 id="相關名詞"><a href="#相關名詞" class="headerlink" title="相關名詞"></a>相關名詞</h1><p>在開始之前，可能要釐清一些相似的概念，<br>包括我自己也是，下面 4 件事情很容易混淆：</p>
<ul>
<li>影像濾波（image filter）</li>
<li>影像濾鏡（image filter）</li>
<li>影像相關（image correlation）</li>
<li>影像卷積（image convlusion）</li>
</ul>
<p>後來看了一些資料，才把這些事情搞清楚。</p>
<div class="note info">
            <p>影像相關（image correlation）的中譯取自《数字图像处理（第三版）》</p>
          </div>

<p>我們先看濾波與濾鏡好了，因為某些不明原因，似乎兩者的英文原文是相同的；<br>不過很濾波是來自於訊號處理，而濾鏡是來自攝影的鏡頭配件。</p>
<p>電腦科學上的濾鏡，這邊採用 Computer Definition 的定義：</p>
<blockquote><p>A software routine that changes the appearance of an image or part of an image by altering the shades and colors of the pixels in some manner. Filters are used to increase brightness and contrast as well as to add a wide variety of textures, tones and special effects to a picture.</p>
</blockquote>

<p>簡單的說，濾鏡是一種「軟體」，任何能夠修改圖像陰影、顏色、明暗的都可以算是一種影像濾鏡。</p>
<p>至於濾波，通常是指「濾波器」（Filter）是來自訊號處理的領域，<br>意思是「濾除某些東西」，用訊號來比方的話，像是低通濾波器，意思是低頻的會通、高頻則被「濾除」了。</p>
<p>很顯然，所以我們可以針對某個域來處理，影像的話，有「空間」跟「頻率」兩個域，<br>分別對應了「空間濾波器」跟「頻率濾波器」兩大類型。至於考量函數特性的線性、非線性也是一種分類方法。</p>
<p>濾波與卷積在訊號處理上是完全不同的東西。應該說，卷積只是濾波的一種操作方法。</p>
<p>在影像處理中，空間濾波的操作是透過相關（correlation）或卷積（convlusion）操作實現的，<br>透過濾波器（filter）在源圖像上進行掃描，然後逐步運算得出新圖像。</p>
<div class="note info">
            <p>濾波器（filter）也被稱為核（kernel）</p>
          </div>

<p>假設 $f(x, y)$ 是 $3 \times 3$ 濾波器，而 $g(x, y)$ 是圖像。<br>若執行「相關」操作，則新圖像 $h(x, y)$ 是：</p>
<p>$$<br>h(x, y) &#x3D; \text{cor}(f(x, y), g(x, y)) &#x3D; \sum\limits_{i&#x3D;-a}^{a} \sum\limits_{j&#x3D;-b}^{b} f(i, j) \cdot g(x + i, y + j)<br>$$</p>
<p>改執行「卷積」操作則為：</p>
<p>$$<br>h(x, y) &#x3D; \text{conv}(f(x, y), g(x, y)) &#x3D; \sum\limits_{i&#x3D;-a}^{a} \sum\limits_{j&#x3D;-b}^{b} f(i, j) \cdot g(x - i, y - j)<br>$$</p>
<p>不同的濾波器會對應不同的效果，可以參考 <a href="https://en.wikipedia.org/wiki/Kernel_(image_processing)" title="" target="">Wikipedia: Kernel (image processing)</a><br>圖像相關跟圖像卷積兩者操作基本上一樣，唯獨卷積在濾波器上轉了 180 度。</p>
<div class="note info">
            <p>這邊的定義是採奇數大小、中心座標為原點的濾波器。<br>意即 $3 \times 3$ 的濾波器，對應的參數為 $a &#x3D; 1, b &#x3D; 1$</p>
          </div>

<h1 id="均值濾波器"><a href="#均值濾波器" class="headerlink" title="均值濾波器"></a>均值濾波器</h1><p>相似地，若輸出為 $h(x, y)$ 數學上的定義為：</p>
<p>$$<br>h(x, y)<br>&#x3D; \frac{\text{cor}(f(x, y), g(x, y))}{\sum\limits_{i&#x3D;-a}^{a} \sum\limits_{j&#x3D;-b}^{b} f(i, j)}<br>&#x3D; \frac{\sum\limits_{i&#x3D;-a}^{a} \sum\limits_{j&#x3D;-b}^{b} f(i, j) \cdot g(x + i, y + j)}{\sum\limits_{i&#x3D;-a}^{a} \sum\limits_{j&#x3D;-b}^{b} f(i, j)}<br>$$</p>
<p>看起來很難懂，其實就是拿著濾波器掃描圖片，然後被濾波器蓋住的地方，就平均一下。</p>
<p><img src="https://i.imgur.com/naVLmQK.png" alt="圖 1、均值濾波器"></p>
<p>參考圖 1 的例子，濾波器放在左上角，經過計算：</p>
<p>$$<br>\sum\limits_{i&#x3D;-1}^{1} \sum\limits_{j&#x3D;-1}^{1} f(i, j) &#x3D; 9<br>$$</p>
<p>所以把對應的格子乘以權重（這邊為 $1$）加起來，然後除以 $9$ 就可以了：</p>
<p>$$<br>h(x, y)<br>&#x3D; \frac{\text{cor}(f(x, y), g(x, y))}{9}<br>&#x3D; \frac{\sum\limits_{i&#x3D;-1}^{1} \sum\limits_{j&#x3D;-1}^{1} f(i, j) \cdot g(x + i, y + j)}{9}<br>$$<br>$$<br>&#x3D; \frac{216+255+255+102+216+255+102+102+255}{9}<br>&#x3D; \frac{1758}{9} &#x3D; 195<br>$$</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 設定變數 */</span></span><br><span class="line"><span class="keyword">let</span> i, j, k, p, q;          <span class="comment">// 用於迴圈的註標</span></span><br><span class="line"><span class="keyword">let</span> sum;                    <span class="comment">// 用於加總圖片濾波器的總和</span></span><br><span class="line"><span class="keyword">let</span> index;                  <span class="comment">// 用於計算實際圖片的像素的位置</span></span><br><span class="line"><span class="keyword">let</span> filter = [              <span class="comment">// 濾波器</span></span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">];</span><br><span class="line"><span class="keyword">let</span> w = imgData.<span class="property">width</span>;      <span class="comment">// 圖片的寬度</span></span><br><span class="line"><span class="keyword">let</span> h = imgData.<span class="property">height</span>;     <span class="comment">// 圖片的長度</span></span><br><span class="line"><span class="keyword">let</span> fw = <span class="number">3</span>;                 <span class="comment">// 濾波器的寬度</span></span><br><span class="line"><span class="keyword">let</span> fh = <span class="number">3</span>;                 <span class="comment">// 濾波器的長度</span></span><br><span class="line"><span class="keyword">let</span> fs = <span class="number">9</span>;                 <span class="comment">// 濾波器的大小</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 建立圖片副本 */</span></span><br><span class="line"><span class="keyword">let</span> newData = imageContext.<span class="title function_">createImageData</span>(w, h);</span><br><span class="line">newData.<span class="property">data</span>.<span class="title function_">set</span>(imgData.<span class="property">data</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 計算濾波器中心，在圖片上的位置 */</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; (w - fw - <span class="number">1</span>); i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt; (h - fh - <span class="number">1</span>); j++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 計算圖片的三種顏色 */</span></span><br><span class="line">        <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">3</span>; k++) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/* 計算濾波器覆蓋圖片區域的平均值 */</span></span><br><span class="line">            sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = -<span class="number">1</span>; p &lt; fw - <span class="number">1</span>; p++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (q = -<span class="number">1</span>; q &lt; fh - <span class="number">1</span>; q++) &#123;</span><br><span class="line">                    index = ((j + q) * w + (i + p)) * <span class="number">4</span> + k;</span><br><span class="line">                    sum += filter[p + <span class="number">1</span>][q + <span class="number">1</span>] * imgData.<span class="property">data</span>[index];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            sum /= fs;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 將平均值賦值給這塊區域的所有像素 */</span></span><br><span class="line">            <span class="keyword">for</span> (p = -<span class="number">1</span>; p &lt; fw - <span class="number">1</span>; p++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (q = -<span class="number">1</span>; q &lt; fh - <span class="number">1</span>; q++) &#123;</span><br><span class="line">                    index = ((j + q) * w + (i + p)) * <span class="number">4</span> + k;</span><br><span class="line">                    newData.<span class="property">data</span>[index] = sum;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 顯示新圖片 */</span></span><br><span class="line">imageContext.<span class="title function_">putImageData</span>(newData, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<div class="note warning">
            <p>實作時，應該另開記憶體空間，以避免取樣到加工過的圖片 $h(x, y)$</p>
          </div>

<h1 id="中值濾波器"><a href="#中值濾波器" class="headerlink" title="中值濾波器"></a>中值濾波器</h1><p>中值濾波器只是在濾波器的範圍內找最大輸出：</p>
<p>$$<br>h(x, y) &#x3D; \max\limits_{i, j \in \{-1, 0, 1\}} g(x + i, y + j)<br>$$</p>
<p><img src="https://i.imgur.com/kQbriZT.png" alt="圖 2、中值濾波器"></p>
<p>中值濾波器的一個功能是，在圖片遭受胡椒鹽雜訊（Salt-and-pepper noise）時，<br>則可以透過中值濾波器修復，參考圖 3 的原圖：</p>
<p><img src="https://i.imgur.com/mGqhnpg.png" alt="圖 3、未受胡椒鹽雜訊汙染的圖像圖"></p>
<p>當遭受胡椒鹽雜訊干擾，呈現圖 4 的樣子：</p>
<p><img src="https://i.imgur.com/yu7R0R9.png" alt="圖 4、胡椒鹽雜訊汙染後的圖像"></p>
<p>我們透過中值濾波器，可以修復為圖 5 的樣子：</p>
<p><img src="https://i.imgur.com/Gpzy1P3.png" alt="圖 5、經中值濾波器復原後的圖像"></p>
<p>不過，當胡椒鹽雜訊過強時，像是圖 6 那樣，中值濾波器也難以修復：</p>
<p><img src="https://i.imgur.com/yAxd9OO.png" alt="圖 6、嚴重胡椒鹽雜訊汙染的圖像"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 設定變數 */</span></span><br><span class="line"><span class="keyword">let</span> i, j, k, p, q;          <span class="comment">// 用於迴圈的註標</span></span><br><span class="line"><span class="keyword">let</span> index;                  <span class="comment">// 用於計算實際圖片的像素的位置</span></span><br><span class="line"><span class="keyword">let</span> arr = [];               <span class="comment">// 用於計算中位數的陣列</span></span><br><span class="line"><span class="keyword">let</span> median;                 <span class="comment">// 紀錄的中位數</span></span><br><span class="line"><span class="keyword">let</span> w = imgData.<span class="property">width</span>;      <span class="comment">// 圖片的寬度</span></span><br><span class="line"><span class="keyword">let</span> h = imgData.<span class="property">height</span>;     <span class="comment">// 圖片的長度</span></span><br><span class="line"><span class="keyword">let</span> fw = <span class="number">3</span>;                 <span class="comment">// 濾波器的寬度</span></span><br><span class="line"><span class="keyword">let</span> fh = <span class="number">3</span>;                 <span class="comment">// 濾波器的長度</span></span><br><span class="line"><span class="keyword">let</span> fs = <span class="number">9</span>;                 <span class="comment">// 濾波器的大小</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 建立圖片副本 */</span></span><br><span class="line"><span class="keyword">let</span> newData = imageContext.<span class="title function_">createImageData</span>(w, h);</span><br><span class="line">newData.<span class="property">data</span>.<span class="title function_">set</span>(imgData.<span class="property">data</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 計算濾波器中心，在圖片上的位置 */</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; (w - fw - <span class="number">1</span>); i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt; (h - fh - <span class="number">1</span>); j++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 計算圖片的三種顏色 */</span></span><br><span class="line">        <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">3</span>; k++) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/* 計算濾波器覆蓋圖片區域的中位數 */</span></span><br><span class="line">            sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = -<span class="number">1</span>; p &lt; fw - <span class="number">1</span>; p++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (q = -<span class="number">1</span>; q &lt; fh - <span class="number">1</span>; q++) &#123;</span><br><span class="line">                    index = ((j + q) * w + (i + p)) * <span class="number">4</span> + k;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">/* 直接找到註標塞值到 arr 中 */</span></span><br><span class="line">                    <span class="comment">/* 效能會比每次都重建陣列 push 來的好 */</span></span><br><span class="line">                    arr[(q + <span class="number">1</span>) * fh + (p + <span class="number">1</span>)] = imgData.<span class="property">data</span>[index];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            arr.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> (a &lt; b ? -<span class="number">1</span> : <span class="number">1</span>)); <span class="comment">// 排序固定數量的 9 個數</span></span><br><span class="line">            median = arr[<span class="number">4</span>];                      <span class="comment">// 中位數是第 5 個數（註標 4）</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 將中位數賦值給這塊區域的所有像素 */</span></span><br><span class="line">            <span class="keyword">for</span> (p = -<span class="number">1</span>; p &lt; fw - <span class="number">1</span>; p++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (q = -<span class="number">1</span>; q &lt; fh - <span class="number">1</span>; q++) &#123;</span><br><span class="line">                    index = ((j + q) * w + (i + p)) * <span class="number">4</span> + k;</span><br><span class="line">                    newData.<span class="property">data</span>[index] = median;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 顯示新圖片 */</span></span><br><span class="line">imageContext.<span class="title function_">putImageData</span>(newData, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h1 id="銳化濾波器"><a href="#銳化濾波器" class="headerlink" title="銳化濾波器"></a>銳化濾波器</h1><p>最後來看銳化濾波器，首先我們定義一階微分，<br>由於我們處理的數值是離散的、且變化量發生在相鄰像素之間，於是定義：</p>
<p>$$ \frac{\partial f}{\partial x} &#x3D; f(x+1) - f(x) $$</p>
<p>同樣地，我們定義二階微分：</p>
<p>$$ \frac{\partial^2 f}{\partial x^2} &#x3D; \frac{\partial f}{\partial x} (f(x+1) - f(x)) $$<br>$$ &#x3D; \frac{\partial f}{\partial x} f(x+1) - \frac{\partial f}{\partial x} f(x) $$<br>$$ &#x3D; (f(x+2) - f(x+1)) - (f(x+1) - f(x)) $$<br>$$ &#x3D; f(x+2) - 2f(x+1) + f(x) $$</p>
<p>我們遞移像素中心到 $x+1$ 所以表示為：</p>
<p>$$ f(x+2) - 2f(x+1) + f(x) $$<br>$$ &#x3D; f(x+1) - 2f(x) + f(x-1) $$</p>
<p>考慮雙變數在偏微分下的情況：</p>
<p>$$ \frac{\partial^2 f(x, y)}{\partial x^2} &#x3D; f(x+1, y) - 2f(x, y) + f(x-1, y) $$</p>
<p>$$ \frac{\partial^2 f(x, y)}{\partial y^2} &#x3D; f(x, y+1) - 2f(x, y) + f(x, y-1) $$</p>
<p>接著定義圖像 $f(x,y)$ 的拉普拉斯算子：</p>
<p>$$ \nabla^2 f(x, y) &#x3D; \frac{\partial^2 f}{\partial x^2} + \frac{\partial^2 f}{\partial y^2} $$</p>
<p>拉普拉斯算子是先做梯度再散度：</p>
<p>$$ \nabla^2 f(x, y) &#x3D; \nabla \cdot (\nabla f) $$</p>
<p>圖像函數 $f(x, y)$ 梯度：</p>
<p>$$ \nabla f(x, y) &#x3D; (\frac{\partial f}{\partial x},  \frac{\partial f}{\partial y}) $$</p>
<p>注意到這一步為止的結果是「向量」。</p>
<p>代表 $\nabla f(x, y)$ 本身是一個平面座標的向量場，接著 $\nabla f(x, y)$ 的散度：</p>
<p>$$ \nabla^2 f(x, y) &#x3D; \nabla \cdot \nabla f(x, y)$$<br>$$ &#x3D; \nabla (\frac{\partial f}{\partial x},  \frac{\partial f}{\partial y}) &#x3D; \frac{\partial^2 f}{\partial x^2} + \frac{\partial^2 f}{\partial y^2} $$</p>
<p>注意到這一步為止的結果是「純量」。</p>
<p>觀察性質上：</p>
<ul>
<li>圖片函數，即你所看到的圖片</li>
<li>圖片函數梯度，即圖片發生像素變化的「方向跟量」</li>
<li>圖片函數梯度的散度，即「圖片發生像素變化的『方向跟量』」的變化量總和</li>
</ul>
<div class="note info">
            <p>因為是總和，所以 $\frac{\partial^2 f}{\partial x^2}$ 跟 $\frac{\partial^2 f}{\partial y^2}$ 有可能會抵消。</p>
          </div>

<p>現在只有變化量，然後我們要「在原圖上加強我們的變化」那就是「加上原圖」得到，所以銳化圖片 $g(x, y)$ 為：</p>
<p>$$g(x, y) &#x3D; f(x, y) + c\left[\nabla^2 f(x, y)\right]$$</p>
<p>其中，常數 $c$ 常見的值為 $c &#x3D; 1$ 或 $c &#x3D; -1$</p>
<p>結合上述的結果，可以得到拉普拉斯的銳化濾波器：</p>
<p>$$ f(x, y) + c[\nabla^2 f(x, y)] &#x3D; f(x, y) + c [\nabla \cdot \nabla f(x, y)]$$<br>$$ &#x3D; f(x, y) + c[\frac{\partial^2 f(x, y)}{\partial x^2} + \frac{\partial^2 f(x, y)}{\partial y^2}]$$<br>$$ &#x3D; f(x, y) + c[f(x+1, y) - 2f(x, y) + f(x-1, y) + f(x, y+1) - 2f(x, y) + f(x, y-1)] $$<br>$$ &#x3D; f(x, y) + c[f(x+1, y) + f(x-1, y) + f(x, y+1) + f(x, y-1) - 4f(x, y)] $$<br>$$ &#x3D; (1 - 4c)f(x, y) + cf(x+1, y) + cf(x-1, y) + cf(x, y+1) + cf(x, y-1)$$</p>
<p>當 $c &#x3D; -1$ 時，濾波器可參考圖 7 所示，式子為：</p>
<p>$$5f(x, y) + f(x+1, y) + f(x-1, y) + f(x, y+1) + f(x, y-1)$$</p>
<p><img src="https://i.imgur.com/mIttFB5.png" alt="圖 7、銳化濾波器"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 設定變數 */</span></span><br><span class="line"><span class="keyword">let</span> i, j, k, p, q;          <span class="comment">// 用於迴圈的註標</span></span><br><span class="line"><span class="keyword">let</span> sum;                    <span class="comment">// 用於加總圖片濾波器的總和</span></span><br><span class="line"><span class="keyword">let</span> index;                  <span class="comment">// 用於計算實際圖片的像素的位置</span></span><br><span class="line"><span class="keyword">let</span> c = -<span class="number">1</span>;                 <span class="comment">// 參考公式，任意常數（常為 -1）</span></span><br><span class="line"><span class="keyword">let</span> filter = [              <span class="comment">// 參考公式，濾波器</span></span><br><span class="line">    [<span class="number">0</span>, c, <span class="number">0</span>],</span><br><span class="line">    [c, <span class="number">1</span> - <span class="number">4</span> * c, c],</span><br><span class="line">    [<span class="number">0</span>, c, <span class="number">0</span>]</span><br><span class="line">];</span><br><span class="line"><span class="keyword">let</span> w = imgData.<span class="property">width</span>;      <span class="comment">// 圖片的寬度</span></span><br><span class="line"><span class="keyword">let</span> h = imgData.<span class="property">height</span>;     <span class="comment">// 圖片的長度</span></span><br><span class="line"><span class="keyword">let</span> fw = <span class="number">3</span>;                 <span class="comment">// 濾波器的寬度</span></span><br><span class="line"><span class="keyword">let</span> fh = <span class="number">3</span>;                 <span class="comment">// 濾波器的長度</span></span><br><span class="line"><span class="keyword">let</span> fs = <span class="number">9</span>;                 <span class="comment">// 濾波器的大小</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 建立圖片副本 */</span></span><br><span class="line"><span class="keyword">let</span> newData = imageContext.<span class="title function_">createImageData</span>(w, h);</span><br><span class="line">newData.<span class="property">data</span>.<span class="title function_">set</span>(imgData.<span class="property">data</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 計算濾波器中心，在圖片上的位置 */</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; (w - fw - <span class="number">1</span>); i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt; (h - fh - <span class="number">1</span>); j++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 計算圖片的三種顏色 */</span></span><br><span class="line">        <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">3</span>; k++) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/* 計算濾波器覆蓋圖片區域的值（參考公式） */</span></span><br><span class="line">            sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = -<span class="number">1</span>; p &lt; fw - <span class="number">1</span>; p++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (q = -<span class="number">1</span>; q &lt; fh - <span class="number">1</span>; q++) &#123;</span><br><span class="line">                    index = ((j + q) * w + (i + p)) * <span class="number">4</span> + k;</span><br><span class="line">                    sum += filter[p + <span class="number">1</span>][q + <span class="number">1</span>] * imgData.<span class="property">data</span>[index];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 將該值賦值給像素（需要限制值域，計算後可能會超出範圍） */</span></span><br><span class="line">            index = (j * w + i) * <span class="number">4</span> + k;</span><br><span class="line">            newData.<span class="property">data</span>[index] = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="title class_">Math</span>.<span class="title function_">min</span>(sum, <span class="number">255</span>), <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 顯示新圖片 */</span></span><br><span class="line">imageContext.<span class="title function_">putImageData</span>(newData, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h1 id="邊界處理"><a href="#邊界處理" class="headerlink" title="邊界處理"></a>邊界處理</h1><p>由於濾波器不會完全覆蓋，所以圖像邊界要特殊處理，常見的方式有 3 種：</p>
<ul>
<li>跳過不處理</li>
<li>在原圖的邊界補零</li>
<li>延伸原圖的邊界</li>
</ul>
<p>跳過不處理的話，濾波器可以從圖像的 $(1, 1)$ 開始，移動至 $(\text{width} - 2, \text{height} - 2)$ 停止。<br/><br>而邊界補零是非常常見的做法，意思是當濾波器跑出範圍，則預設給 $0$ 值，參考圖 8，<br/><br>不過缺點是輸出的邊界很容易黑黑的，但是可以省去很多例外條件的判斷。</p>
<p><img src="https://i.imgur.com/3CBMICm.png" alt="圖 8、邊界處理：補零"></p>
<p>至於為了獲得更好的效果，我們可以像圖 9 那樣，<br>把圖片的邊界「延伸」到圖片外一圈，如此一來，就會得到更好的效果。</p>
<p><img src="https://i.imgur.com/DgqiZSQ.png" alt="圖 9、邊界處理：延伸"></p>
<h1 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h1><iframe scrolling="no" width="100%" height="530px" src="https://jsfiddle.net/40unwrc5/embedded/result,js,html,css/dark" frameborder="0" loading="lazy" allowfullscreen></iframe>

<div class="note info">
            <p>此演示的圖像邊界是採用「跳過不處理」的方式</p>
          </div>

<h1 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h1><ul>
<li>《数字图像处理（第三版）》(ISBN：9787121110085)</li>
<li><a target="_blank" rel="noopener" href="https://www.yourdictionary.com/image-filter">image filter - Computer Definition</a></li>
<li><a target="_blank" rel="noopener" href="https://rocky69.pixnet.net/blog/post/218272785-%5B%E8%BD%89%5D%E6%BF%BE%E6%B3%A2%E5%92%8C%E5%8D%B7%E7%A9%8D">滤波和卷积</a></li>
<li><a href="https://en.wikipedia.org/wiki/Kernel_(image_processing)" title="" target="">Wikipedia: Kernel (image processing)</a></li>
<li><a href="https://en.wikipedia.org/wiki/Salt-and-pepper_noise" title="" target="">Wikipedia: Salt-and-pepper noise</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/histogram-equalization/" rel="prev" title="直方圖均化 Histogram Equalization">
      <i class="fa fa-chevron-left"></i> 直方圖均化 Histogram Equalization
    </a></div>
      <div class="post-nav-item">
    <a href="/pointer/" rel="next" title="指標 Pointer">
      指標 Pointer <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%B8%E9%97%9C%E5%90%8D%E8%A9%9E"><span class="nav-number">1.</span> <span class="nav-text">相關名詞</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9D%87%E5%80%BC%E6%BF%BE%E6%B3%A2%E5%99%A8"><span class="nav-number">2.</span> <span class="nav-text">均值濾波器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%AD%E5%80%BC%E6%BF%BE%E6%B3%A2%E5%99%A8"><span class="nav-number">3.</span> <span class="nav-text">中值濾波器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%8A%B3%E5%8C%96%E6%BF%BE%E6%B3%A2%E5%99%A8"><span class="nav-number">4.</span> <span class="nav-text">銳化濾波器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%82%8A%E7%95%8C%E8%99%95%E7%90%86"><span class="nav-number">5.</span> <span class="nav-text">邊界處理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%BC%94%E7%A4%BA"><span class="nav-number">6.</span> <span class="nav-text">演示</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99"><span class="nav-number">7.</span> <span class="nav-text">參考資料</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tinytusnami"
      src="/images/head.jpg">
  <p class="site-author-name" itemprop="name">Tinytusnami</p>
  <div class="site-description" itemprop="description">羊羽的個人部落格</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tinytsunami" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tinytsunami" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/TaipeiTsunami" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;TaipeiTsunami" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/profile.php?id=100000736195394" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100000736195394" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i>FB Page</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.youtube.com/channel/UCtqp9w_uA_LohDm0YXNWqSA" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCtqp9w_uA_LohDm0YXNWqSA" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>YouTube</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      友站連結
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://blog.cyris.tw/" title="https:&#x2F;&#x2F;blog.cyris.tw" rel="noopener" target="_blank">Cyris's Blog</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-bomb"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tinytusnami</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 強力驅動
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '32px',
  right: '32px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#333',
  buttonColorLight: '#eee',
  saveInCookies: true,
  label: '',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '8b224f954e247f37ca81',
      clientSecret: '36ffe64406d0cfaa8d1811ebf27c58638876fc8d',
      repo        : 'tinytsunami.github.io',
      owner       : 'tinytsunami',
      admin       : ['tinytsunami'],
      id          : '46e2d40c846593d41c64a4a6b8ea5216',
        language: 'zh-TW',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>
<script>
(function() {

  const callback = function() {
    let html = document.getElementsByTagName('html')[0];
    //let head = document.getElementsByClassName('site-author-image')[0];

    if (window.darkmode.isActivated()) {  
      html.setAttribute("class", "darkmode--activated");
      //head.setAttribute("src", "/images/head-dark.jpg");
    }
    else {
      html.removeAttribute("class");
      //head.setAttribute("src", "/images/head.jpg");
    }
  };

  const config = { attributes: true, childList: false, subtree: false};

  const observer = new MutationObserver((mutationsList, observer) => {
    for(const mutation of mutationsList) {
      if (mutation.type === 'attributes') {
        if (mutation.attributeName === 'class') {
          callback();
        }
      }
    }
  });

  observer.observe(document.body, config);

  callback();
})();
</script>

</body>
</html>
